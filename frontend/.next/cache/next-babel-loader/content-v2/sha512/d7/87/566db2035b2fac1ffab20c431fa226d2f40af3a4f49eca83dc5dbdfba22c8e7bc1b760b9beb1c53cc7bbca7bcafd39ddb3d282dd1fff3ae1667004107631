{"ast":null,"code":"import React from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport TextField from '@material-ui/core/TextField';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport IconButton from '@material-ui/core/IconButton';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FilledInput from '@material-ui/core/FilledInput';\nimport Alert from '@material-ui/lab/Alert';\nimport VisibilityOff from '@material-ui/icons/VisibilityOff';\nimport Visibility from '@material-ui/icons/Visibility';\nimport { addSession, testSessionConnection } from '../api/bbgo';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nconst useStyles = makeStyles(theme => ({\n  formControl: {\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1),\n    minWidth: 120\n  },\n  buttons: {\n    display: 'flex',\n    justifyContent: 'flex-end',\n    marginTop: theme.spacing(2),\n    paddingTop: theme.spacing(2),\n    paddingBottom: theme.spacing(2),\n    '& > *': {\n      marginLeft: theme.spacing(1)\n    }\n  }\n}));\nexport default function AddExchangeSessionForm({\n  onBack,\n  onAdded\n}) {\n  const classes = useStyles();\n  const [exchangeType, setExchangeType] = React.useState('max');\n  const [customSessionName, setCustomSessionName] = React.useState(false);\n  const [sessionName, setSessionName] = React.useState(exchangeType);\n  const [testing, setTesting] = React.useState(false);\n  const [testResponse, setTestResponse] = React.useState(null);\n  const [response, setResponse] = React.useState(null);\n  const [apiKey, setApiKey] = React.useState('');\n  const [apiSecret, setApiSecret] = React.useState('');\n  const [showApiKey, setShowApiKey] = React.useState(false);\n  const [showApiSecret, setShowApiSecret] = React.useState(false);\n  const [isMargin, setIsMargin] = React.useState(false);\n  const [isIsolatedMargin, setIsIsolatedMargin] = React.useState(false);\n  const [isolatedMarginSymbol, setIsolatedMarginSymbol] = React.useState(\"\");\n\n  const resetTestResponse = () => {\n    setTestResponse(null);\n  };\n\n  const handleExchangeTypeChange = event => {\n    setExchangeType(event.target.value);\n    setSessionName(event.target.value);\n    resetTestResponse();\n  };\n\n  const createSessionConfig = () => {\n    return {\n      name: sessionName,\n      exchange: exchangeType,\n      key: apiKey,\n      secret: apiSecret,\n      margin: isMargin,\n      envVarPrefix: exchangeType.toUpperCase(),\n      isolatedMargin: isIsolatedMargin,\n      isolatedMarginSymbol: isolatedMarginSymbol\n    };\n  };\n\n  const handleAdd = event => {\n    const payload = createSessionConfig();\n    addSession(payload, response => {\n      setResponse(response);\n\n      if (onAdded) {\n        setTimeout(onAdded, 3000);\n      }\n    }).catch(error => {\n      console.error(error);\n      setResponse(error.response);\n    });\n  };\n\n  const handleTestConnection = event => {\n    const payload = createSessionConfig();\n    setTesting(true);\n    testSessionConnection(payload, response => {\n      console.log(response);\n      setTesting(false);\n      setTestResponse(response);\n    }).catch(error => {\n      console.error(error);\n      setTesting(false);\n      setTestResponse(error.response);\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(React.Fragment, {\n    children: [/*#__PURE__*/_jsx(Typography, {\n      variant: \"h6\",\n      gutterBottom: true,\n      children: \"Add Exchange Session\"\n    }), /*#__PURE__*/_jsxs(Grid, {\n      container: true,\n      spacing: 3,\n      children: [/*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsxs(FormControl, {\n          className: classes.formControl,\n          children: [/*#__PURE__*/_jsx(InputLabel, {\n            id: \"exchange-type-select-label\",\n            children: \"Exchange\"\n          }), /*#__PURE__*/_jsxs(Select, {\n            labelId: \"exchange-type-select-label\",\n            id: \"exchange-type-select\",\n            value: exchangeType,\n            onChange: handleExchangeTypeChange,\n            children: [/*#__PURE__*/_jsx(MenuItem, {\n              value: \"binance\",\n              children: \"Binance\"\n            }), /*#__PURE__*/_jsx(MenuItem, {\n              value: \"max\",\n              children: \"Max\"\n            })]\n          })]\n        })\n      }), /*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        sm: 6,\n        children: /*#__PURE__*/_jsx(TextField, {\n          id: \"name\",\n          name: \"name\",\n          label: \"Session Name\",\n          fullWidth: true,\n          required: true,\n          disabled: !customSessionName,\n          onChange: event => {\n            setSessionName(event.target.value);\n          },\n          value: sessionName\n        })\n      }), /*#__PURE__*/_jsxs(Grid, {\n        item: true,\n        xs: 12,\n        sm: 6,\n        children: [/*#__PURE__*/_jsx(FormControlLabel, {\n          control: /*#__PURE__*/_jsx(Checkbox, {\n            color: \"secondary\",\n            name: \"custom_session_name\",\n            onChange: event => {\n              setCustomSessionName(event.target.checked);\n            },\n            value: \"1\"\n          }),\n          label: \"Custom exchange session name\"\n        }), /*#__PURE__*/_jsxs(FormHelperText, {\n          id: \"session-name-helper-text\",\n          children: [\"By default, the session name will be the exchange type name, e.g. \", /*#__PURE__*/_jsx(\"code\", {\n            children: \"binance\"\n          }), \" or \", /*#__PURE__*/_jsx(\"code\", {\n            children: \"max\"\n          }), \".\", /*#__PURE__*/_jsx(\"br\", {}), \"If you're using multiple exchange sessions, you might need to custom the session name. \", /*#__PURE__*/_jsx(\"br\", {}), \"This is for advanced users.\"]\n        })]\n      }), /*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsxs(FormControl, {\n          fullWidth: true,\n          variant: \"filled\",\n          children: [/*#__PURE__*/_jsx(InputLabel, {\n            htmlFor: \"apiKey\",\n            children: \"API Key\"\n          }), /*#__PURE__*/_jsx(FilledInput, {\n            id: \"apiKey\",\n            type: showApiKey ? 'text' : 'password',\n            value: apiKey,\n            endAdornment: /*#__PURE__*/_jsx(InputAdornment, {\n              position: \"end\",\n              children: /*#__PURE__*/_jsx(IconButton, {\n                \"aria-label\": \"toggle key visibility\",\n                onClick: () => {\n                  setShowApiKey(!showApiKey);\n                },\n                onMouseDown: event => {\n                  event.preventDefault();\n                },\n                edge: \"end\",\n                children: showApiKey ? /*#__PURE__*/_jsx(Visibility, {}) : /*#__PURE__*/_jsx(VisibilityOff, {})\n              })\n            }),\n            onChange: event => {\n              setApiKey(event.target.value);\n              resetTestResponse();\n            }\n          })]\n        })\n      }), /*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsxs(FormControl, {\n          fullWidth: true,\n          variant: \"filled\",\n          children: [/*#__PURE__*/_jsx(InputLabel, {\n            htmlFor: \"apiSecret\",\n            children: \"API Secret\"\n          }), /*#__PURE__*/_jsx(FilledInput, {\n            id: \"apiSecret\",\n            type: showApiSecret ? 'text' : 'password',\n            value: apiSecret,\n            endAdornment: /*#__PURE__*/_jsx(InputAdornment, {\n              position: \"end\",\n              children: /*#__PURE__*/_jsx(IconButton, {\n                \"aria-label\": \"toggle key visibility\",\n                onClick: () => {\n                  setShowApiSecret(!showApiSecret);\n                },\n                onMouseDown: event => {\n                  event.preventDefault();\n                },\n                edge: \"end\",\n                children: showApiSecret ? /*#__PURE__*/_jsx(Visibility, {}) : /*#__PURE__*/_jsx(VisibilityOff, {})\n              })\n            }),\n            onChange: event => {\n              setApiSecret(event.target.value);\n              resetTestResponse();\n            }\n          })]\n        })\n      }), exchangeType === \"binance\" ? /*#__PURE__*/_jsxs(Grid, {\n        item: true,\n        xs: 12,\n        children: [/*#__PURE__*/_jsx(FormControlLabel, {\n          control: /*#__PURE__*/_jsx(Checkbox, {\n            color: \"secondary\",\n            name: \"isMargin\",\n            onChange: event => {\n              setIsMargin(event.target.checked);\n              resetTestResponse();\n            },\n            value: \"1\"\n          }),\n          label: \"Use margin trading.\"\n        }), /*#__PURE__*/_jsx(FormHelperText, {\n          id: \"isMargin-helper-text\",\n          children: \"This is only available for Binance. Please use the leverage at your own risk.\"\n        }), /*#__PURE__*/_jsx(FormControlLabel, {\n          control: /*#__PURE__*/_jsx(Checkbox, {\n            color: \"secondary\",\n            name: \"isIsolatedMargin\",\n            onChange: event => {\n              setIsIsolatedMargin(event.target.checked);\n              resetTestResponse();\n            },\n            value: \"1\"\n          }),\n          label: \"Use isolated margin trading.\"\n        }), /*#__PURE__*/_jsx(FormHelperText, {\n          id: \"isIsolatedMargin-helper-text\",\n          children: \"This is only available for Binance. If this is set, you can only trade one symbol with one session.\"\n        }), isIsolatedMargin ? /*#__PURE__*/_jsx(TextField, {\n          id: \"isolatedMarginSymbol\",\n          name: \"isolatedMarginSymbol\",\n          label: \"Isolated Margin Symbol\",\n          onChange: event => {\n            setIsolatedMarginSymbol(event.target.value);\n            resetTestResponse();\n          },\n          fullWidth: true,\n          required: true\n        }) : null]\n      }) : null]\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: classes.buttons,\n      children: [/*#__PURE__*/_jsx(Button, {\n        onClick: () => {\n          if (onBack) {\n            onBack();\n          }\n        },\n        children: \"Back\"\n      }), /*#__PURE__*/_jsx(Button, {\n        color: \"primary\",\n        onClick: handleTestConnection,\n        disabled: testing,\n        children: testing ? \"Testing\" : \"Test Connection\"\n      }), /*#__PURE__*/_jsx(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: handleAdd,\n        children: \"Add\"\n      })]\n    }), testResponse ? testResponse.error ? /*#__PURE__*/_jsx(Box, {\n      m: 2,\n      children: /*#__PURE__*/_jsx(Alert, {\n        severity: \"error\",\n        children: testResponse.error\n      })\n    }) : testResponse.success ? /*#__PURE__*/_jsx(Box, {\n      m: 2,\n      children: /*#__PURE__*/_jsx(Alert, {\n        severity: \"success\",\n        children: \"Connection Test Succeeded\"\n      })\n    }) : null : null, response ? response.error ? /*#__PURE__*/_jsx(Box, {\n      m: 2,\n      children: /*#__PURE__*/_jsx(Alert, {\n        severity: \"error\",\n        children: response.error\n      })\n    }) : response.success ? /*#__PURE__*/_jsx(Box, {\n      m: 2,\n      children: /*#__PURE__*/_jsx(Alert, {\n        severity: \"success\",\n        children: \"Exchange Session Added\"\n      })\n    }) : null : null]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}