{"ast":null,"code":"var _jsxFileName = \"/Users/austin/Desktop/bbgo/frontend/components/TradingVolumeBar.js\";\nimport { ResponsiveBar } from '@nivo/bar';\nimport { queryTradingVolume } from '../api/bbgo';\nimport { useEffect, useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction toPeriodDateString(time, period) {\n  switch (period) {\n    case \"day\":\n      return time.getFullYear() + \"-\" + (time.getMonth() + 1) + \"-\" + time.getDate();\n\n    case \"month\":\n      return time.getFullYear() + \"-\" + (time.getMonth() + 1);\n\n    case \"year\":\n      return time.getFullYear();\n  }\n\n  return time.getFullYear() + \"-\" + (time.getMonth() + 1) + \"-\" + time.getDate();\n}\n\nfunction groupData(rows, period, segment) {\n  let dateIndex = {};\n  let startTime = null;\n  let endTime = null;\n  let keys = {};\n  rows.forEach(v => {\n    const time = new Date(v.time);\n\n    if (!startTime) {\n      startTime = time;\n    }\n\n    endTime = time;\n    const dateStr = toPeriodDateString(time, period);\n    const key = v[segment];\n    keys[key] = true;\n    const k = key ? key : \"total\";\n    const quoteVolume = Math.round(v.quoteVolume * 100) / 100;\n\n    if (dateIndex[dateStr]) {\n      dateIndex[dateStr][k] = quoteVolume;\n    } else {\n      dateIndex[dateStr] = {\n        date: dateStr,\n        year: time.getFullYear(),\n        month: time.getMonth() + 1,\n        day: time.getDate(),\n        [k]: quoteVolume\n      };\n    }\n  });\n  let data = [];\n\n  while (startTime < endTime) {\n    const dateStr = toPeriodDateString(startTime, period);\n    const groupData = dateIndex[dateStr];\n\n    if (groupData) {\n      data.push(groupData);\n    } else {\n      data.push({\n        date: dateStr,\n        year: startTime.getFullYear(),\n        month: startTime.getMonth() + 1,\n        day: startTime.getDate(),\n        total: 0\n      });\n    }\n\n    switch (period) {\n      case \"day\":\n        startTime.setDate(startTime.getDate() + 1);\n        break;\n\n      case \"month\":\n        startTime.setMonth(startTime.getMonth() + 1);\n        break;\n\n      case \"year\":\n        startTime.setFullYear(startTime.getFullYear() + 1);\n        break;\n    }\n  }\n\n  return [data, Object.keys(keys)];\n}\n\nexport default function TradingVolumeBar(props) {\n  const {\n    0: tradingVolumes,\n    1: setTradingVolumes\n  } = useState([]);\n  const {\n    0: period,\n    1: setPeriod\n  } = useState(props.period);\n  const {\n    0: segment,\n    1: setSegment\n  } = useState(props.segment);\n  useEffect(() => {\n    if (props.period !== period) {\n      setPeriod(props.period);\n    }\n\n    if (props.segment !== segment) {\n      setSegment(props.segment);\n    }\n\n    queryTradingVolume({\n      period: props.period,\n      segment: props.segment\n    }, tradingVolumes => {\n      setTradingVolumes(tradingVolumes);\n    });\n  }, [props.period, props.segment]);\n  const [data, keys] = groupData(tradingVolumes, period, segment);\n  return /*#__PURE__*/_jsxDEV(ResponsiveBar, {\n    keys: keys,\n    data: data,\n    indexBy: \"date\",\n    margin: {\n      top: 50,\n      right: 160,\n      bottom: 100,\n      left: 60\n    },\n    padding: 0.3,\n    valueScale: {\n      type: 'linear'\n    },\n    indexScale: {\n      type: 'band',\n      round: true\n    },\n    labelSkipWidth: 30,\n    labelSkipHeight: 20,\n    enableGridY: true,\n    colors: {\n      scheme: 'paired'\n    },\n    axisBottom: {\n      tickRotation: -90,\n      legend: period,\n      legendPosition: 'middle',\n      legendOffset: 80\n    },\n    legends: [{\n      dataFrom: 'keys',\n      anchor: 'right',\n      direction: 'column',\n      justify: false,\n      translateX: 120,\n      translateY: 0,\n      itemsSpacing: 2,\n      itemWidth: 100,\n      itemHeight: 20,\n      itemDirection: 'left-to-right',\n      itemOpacity: 0.85,\n      symbolSize: 20,\n      effects: [{\n        on: 'hover',\n        style: {\n          itemOpacity: 1\n        }\n      }]\n    }],\n    animate: true,\n    motionStiffness: 90,\n    motionDamping: 15\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 12\n  }, this);\n}","map":{"version":3,"sources":["/Users/austin/Desktop/bbgo/frontend/components/TradingVolumeBar.js"],"names":["ResponsiveBar","queryTradingVolume","useEffect","useState","toPeriodDateString","time","period","getFullYear","getMonth","getDate","groupData","rows","segment","dateIndex","startTime","endTime","keys","forEach","v","Date","dateStr","key","k","quoteVolume","Math","round","date","year","month","day","data","push","total","setDate","setMonth","setFullYear","Object","TradingVolumeBar","props","tradingVolumes","setTradingVolumes","setPeriod","setSegment","top","right","bottom","left","type","scheme","tickRotation","legend","legendPosition","legendOffset","dataFrom","anchor","direction","justify","translateX","translateY","itemsSpacing","itemWidth","itemHeight","itemDirection","itemOpacity","symbolSize","effects","on","style"],"mappings":"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","sourcesContent":["import {ResponsiveBar} from '@nivo/bar';\nimport {queryTradingVolume} from '../api/bbgo';\nimport {useEffect, useState} from \"react\";\n\nfunction toPeriodDateString(time, period) {\n    switch (period) {\n        case \"day\":\n            return time.getFullYear() + \"-\" + (time.getMonth() + 1) + \"-\" + time.getDate()\n        case \"month\":\n            return time.getFullYear() + \"-\" + (time.getMonth() + 1)\n        case \"year\":\n            return time.getFullYear()\n\n    }\n\n    return time.getFullYear() + \"-\" + (time.getMonth() + 1) + \"-\" + time.getDate()\n}\n\nfunction groupData(rows, period, segment) {\n    let dateIndex = {}\n    let startTime = null\n    let endTime = null\n    let keys = {}\n\n    rows.forEach((v) => {\n        const time = new Date(v.time)\n        if (!startTime) {\n            startTime = time\n        }\n\n        endTime = time\n\n        const dateStr = toPeriodDateString(time, period)\n        const key = v[segment]\n\n        keys[key] = true\n\n        const k = key ? key : \"total\"\n        const quoteVolume = Math.round(v.quoteVolume * 100) / 100\n\n        if (dateIndex[dateStr]) {\n            dateIndex[dateStr][k] = quoteVolume\n        } else {\n            dateIndex[dateStr] = {\n                date: dateStr,\n                year: time.getFullYear(),\n                month: time.getMonth() + 1,\n                day: time.getDate(),\n                [k]: quoteVolume,\n            }\n        }\n    })\n\n    let data = []\n    while (startTime < endTime) {\n        const dateStr = toPeriodDateString(startTime, period)\n        const groupData = dateIndex[dateStr]\n        if (groupData) {\n            data.push(groupData)\n        } else {\n            data.push({\n                date: dateStr,\n                year: startTime.getFullYear(),\n                month: startTime.getMonth() + 1,\n                day: startTime.getDate(),\n                total: 0,\n            })\n        }\n\n        switch (period) {\n            case \"day\":\n                startTime.setDate(startTime.getDate() + 1)\n                break\n            case \"month\":\n                startTime.setMonth(startTime.getMonth() + 1)\n                break\n            case \"year\":\n                startTime.setFullYear(startTime.getFullYear() + 1)\n                break\n        }\n    }\n\n    return [data, Object.keys(keys)]\n}\n\nexport default function TradingVolumeBar(props) {\n    const [tradingVolumes, setTradingVolumes] = useState([])\n    const [period, setPeriod] = useState(props.period)\n    const [segment, setSegment] = useState(props.segment)\n\n    useEffect(() => {\n        if (props.period !== period) {\n            setPeriod(props.period);\n        }\n\n        if (props.segment !== segment) {\n            setSegment(props.segment);\n        }\n\n        queryTradingVolume({period: props.period, segment: props.segment }, (tradingVolumes) => {\n            setTradingVolumes(tradingVolumes)\n        })\n    }, [props.period, props.segment])\n\n    const [data, keys] = groupData(tradingVolumes, period, segment)\n\n    return <ResponsiveBar keys={keys}\n                          data={data}\n                          indexBy={\"date\"}\n                          margin={{top: 50, right: 160, bottom: 100, left: 60}}\n                          padding={0.3}\n                          valueScale={{type: 'linear'}}\n                          indexScale={{type: 'band', round: true}}\n                          labelSkipWidth={30}\n                          labelSkipHeight={20}\n                          enableGridY={true}\n                          colors={{scheme: 'paired'}}\n                          axisBottom={{\n                              tickRotation: -90,\n                              legend: period,\n                              legendPosition: 'middle',\n                              legendOffset: 80\n                          }}\n                          legends={[\n                              {\n                                  dataFrom: 'keys',\n                                  anchor: 'right',\n                                  direction: 'column',\n                                  justify: false,\n                                  translateX: 120,\n                                  translateY: 0,\n                                  itemsSpacing: 2,\n                                  itemWidth: 100,\n                                  itemHeight: 20,\n                                  itemDirection: 'left-to-right',\n                                  itemOpacity: 0.85,\n                                  symbolSize: 20,\n                                  effects: [\n                                      {\n                                          on: 'hover',\n                                          style: {\n                                              itemOpacity: 1\n                                          }\n                                      }\n                                  ]\n                              }\n                          ]}\n                          animate={true}\n                          motionStiffness={90}\n                          motionDamping={15}\n    />;\n}\n"]},"metadata":{},"sourceType":"module"}